{# os_app/templates/os_app/listar_os.html #}
{% extends "base.html" %}
{% block content %}
  <h1>Ordens de Serviço</h1>

  {% if ordens %}
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Descrição</th>
          <th>Status</th>
          <th>Abertura</th>
          <th>Placa</th>
          <th>Proprietário</th>
          <th>Entrada</th>
          <th>Previsão</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        {% for o in ordens %}
        <tr>
          <td>{% if o.idordem %}{{ o.idordem }}{% elif o.id %}{{ o.id }}{% else %}-{% endif %}</td>
          <td>{{ o.descricaoobjeto|default:"(sem descrição)" }}</td>
          <td>{{ o.situacao|default:"-" }}</td>
          <td>
            {% if o.aberturadata %}{{ o.aberturadata|date:"d/m/Y" }}{% endif %}
            {% if o.aberturahora %} {{ o.aberturahora|time:"H:i" }}{% endif %}
            {% if not o.aberturadata and not o.aberturahora %}-{% endif %}
          </td>
          <td>{{ o.placa|default:"-" }}</td>
          <td>{{ o.proprietario|default:"-" }}</td>
          <td>
            {% if o.entrada is not None and o.entrada != "" %}
              R$ {{ o.entrada|floatformat:2 }}
            {% else %}
              -
            {% endif %}
          </td>
          <td>
            {% if o.previsao_data or o.previsao_hora %}
              {% if o.previsao_data %}{{ o.previsao_data|date:"d/m/Y" }}{% endif %}
              {% if o.previsao_hora %} {{ o.previsao_hora|time:"H:i" }}{% endif %}
            {% else %}
              -
            {% endif %}
          </td>

          <td class="actions">
            {# gerar links/ forms escolhendo o id existente (idordem ou id) #}
            {% if o.idordem %}
              <a href="{% url 'os_app:editar_os' o.idordem %}">Editar</a>

              <form action="{% url 'os_app:cancelar_os' o.idordem %}" method="post" style="display:inline" class="confirm-delete">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning" onclick="return confirm('Confirma cancelamento da OS {{ o.idordem }}?')">Cancelar</button>
              </form>
            {% elif o.id %}
              <a href="{% url 'os_app:editar_os' o.id %}">Editar</a>

              <form action="{% url 'os_app:cancelar_os' o.id %}" method="post" style="display:inline" class="confirm-delete">
                {% csrf_token %}
                <button type="submit" class="btn btn-warning" onclick="return confirm('Confirma cancelamento da OS {{ o.id }}?')">Cancelar</button>
              </form>
            {% else %}
              -
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>Não há ordens cadastradas.</p>
  {% endif %}

  <p style="margin-top:12px">
    <a class="btn" href="{% url 'os_app:abrir_os' %}">Abrir nova OS</a>
  </p>
{% endblock %}
